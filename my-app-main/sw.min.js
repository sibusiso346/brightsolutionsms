const CACHE_NAME='bright-solutions-v1.0.0';const STATIC_CACHE='static-cache-v1';const DYNAMIC_CACHE='dynamic-cache-v1';const STATIC_FILES=['/','/index.html','/styles.min.css','/script.min.js','/protection.min.js','/sw.min.js','/site.webmanifest','/images/brightsolutionsms.png','/images/brightsolutionsms-Icon.PNG','https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap','https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css'];self.addEventListener('install',function(event){console.log('[SW] Installing...');event.waitUntil(caches.open(STATIC_CACHE).then(function(cache){console.log('[SW] Caching static files');return cache.addAll(STATIC_FILES)}).then(function(){console.log('[SW] Static files cached');return self.skipWaiting()}).catch(function(error){console.log('[SW] Cache failed:',error)})});self.addEventListener('activate',function(event){console.log('[SW] Activating...');event.waitUntil(caches.keys().then(function(cacheNames){return Promise.all(cacheNames.map(function(cacheName){if(cacheName!==STATIC_CACHE&&cacheName!==DYNAMIC_CACHE){console.log('[SW] Deleting old cache:',cacheName);return caches.delete(cacheName)}}))}).then(function(){console.log('[SW] Activated');return self.clients.claim()}))});self.addEventListener('fetch',function(event){if(event.request.method!=='GET'){return}const url=new URL(event.request.url);if(!url.origin.match(/(localhost|brightsolutionsms\.com|fonts\.googleapis\.com|fonts\.gstatic\.com|cdnjs\.cloudflare\.com|cdn\.jsdelivr\.net)/)){return}event.respondWith(caches.match(event.request).then(function(response){if(response){console.log('[SW] Serving from cache:',event.request.url);return response}const fetchRequest=event.request.clone();return fetch(fetchRequest).then(function(response){if(!response||response.status!==200||response.type!=='basic'){return response}const responseToCache=response.clone();caches.open(DYNAMIC_CACHE).then(function(cache){cache.put(event.request,responseToCache);console.log('[SW] Cached dynamic resource:',event.request.url)});return response}).catch(function(error){console.log('[SW] Fetch failed:',error);if(event.request.destination==='document'){return caches.match('/index.html')}})}))});self.addEventListener('sync',function(event){if(event.tag==='contact-form'){event.waitUntil(console.log('[SW] Background sync: contact form'))}});self.addEventListener('push',function(event){if(event.data){const data=event.data.json();const options={body:data.body,icon:'/images/brightsolutionsms.png',badge:'/images/brightsolutionsms.png',vibrate:[200,100,200],data:{dateOfArrival:Date.now(),primaryKey:1}};event.waitUntil(self.registration.showNotification(data.title,options))}});self.addEventListener('notificationclick',function(event){event.notification.close();event.waitUntil(clients.openWindow('/'))});
